@using System.Globalization
@model Moridge.Models.BookingModel

@{
    ViewBag.Title = "Driver Page";
}
<link rel="stylesheet" type="text/css" href="~/Content/themes/moridge/moridge.style.css" />

<script>
    //Make the clicked button stay active until the popup is closed.
    $(document).ready(function () {
        $("*#bookingButton").click(function () {
            toggleActive(this);
        });
        $("#popupMenu").bind({
            popupafterclose: function () {
                $("*#active").each(function () {
                    toggleActive(this);
                });
            }
        });

        function toggleActive(button) {
            $(button).toggleClass("active");
            $(button).attr("id", $(button).attr("id") === "active" ? "bookingButton" : "active");
        }

        //Adds content dynamically
        $('*#bookingButton').click(function () {
            var occassions = $(this).data('occassions');
            console.log(occassions);
            var popup = $('#popup-listview');
            popup.empty();

            $('<li data-role="divider" class="popup-header">Förmiddag</li>').appendTo(popup);

            //List all bookings for this occassions.
            for (var i = 0; i < occassions; i++) {
                $('<li><a href="#" class="popup-header">Grankottevägen 55</a></li>').appendTo(popup);
            }

            popup.listview('refresh'); 
            $("#popupMenu").popup("open", {
                positionTo: "window", 
                transition: "pop"
            });
        });
    });

    //set this navbar as active
    //$(":jqmData(role=page)").bind("pagebeforeshow", function () {
    //    var $footers = $(document).find('div[data-role="footer"]');
    //    $footers.find('a[id=Booking]').addClass("ui-btn-active");
    //});
</script>

@Html.ValidationSummary()

<ul data-role="listview" class="ui-listview">

    @foreach (var day in Model.Days)
    {
        <li data-role="list-divider" role="heading" class="ui-li ui-li-divider ui-bar-d ui-li-has-count">
            @Model.DayString(day)
            <span class="ui-li-count ui-btn-up-c ui-btn-corner-all">2</span>
        </li>

        foreach (var occassion in Model.OccasionsPerDay)
        {
            <li>
                <a href="#" data-occassions=@Model.GetBookingsForOccasion(day, occassion)
                   id="bookingButton" data-rel="popup" data-position-to="origin" data-inline="true" data-transition="pop">
                    <p class="ui-li-aside ui-li-desc link-header">
                        <strong>
                            @occassion
                        </strong>
                    </p>
                    <h3 class="ui-li-heading ">3 av 4 bokningar</h3>
                    <p class="ui-li-desc ">Vad ska det stå här?</p>
                </a>
            </li>
        }
    }
</ul>


<div data-role="popup" id="popupMenu" data-theme="a">
    <ul data-role="listview" id="popup-listview" data-inset="true" style="min-width: 210px;">
    </ul>
</div>

<div data-role="footer" data-theme="b" data-position="fixed" data-id="footer" data-tap-toggle="false">
    <div data-role="navbar">
        <ul>
            <li><a href="#"
                class="ui-btn-active ui-state-persist" id="Booking" data-transition="slide"><span>
                    <i class="material-icons">assignment</i>
                    <span style="font-size: 12px; display: block;">Boka</span>
                </span></a>
            </li>
            <li><a href="@Url.Action("Schedule", "Driver")" data-transition="slide"><span>
                <i class="material-icons">event</i>
                <span style="font-size: 12px; display: block;">Arbetsschema</span>
            </span></a></li>
            <li>
                <a href="@Url.Action("PersonalInfo", "Driver")" data-transition="slide"><span>
                    <i class="material-icons">account_box</i>
                    <span style="font-size: 12px; display: block;">Redigera Info</span>
                </span></a>
            </li>
        </ul>
    </div>
</div>
